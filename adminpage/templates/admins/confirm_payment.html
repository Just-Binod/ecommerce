{% extends "admins/index.html" %} {% load static %}

<!---->
{% block page_title %}Payment Confirmation{% endblock %}

<!---->
{% block page_subtitle %}Manage Cash on Delivery orders and confirm payments

<!---->
{% endblock %} {% block admin_content %}
<div class="p-2 sm:ml-64">
  <div class="max-w-6xl mx-auto px-4">
    <!-- Header -->
    <div
      class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6"
    >
      <div
        class="flex flex-col md:flex-row justify-between items-start md:items-center"
      >
        <div>
          <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
            Payment Confirmation
          </h1>
          <p class="text-gray-600 dark:text-gray-400 mt-1">
            Manage and confirm Cash on Delivery payments
          </p>
        </div>
        <div class="flex items-center space-x-3 mt-4 md:mt-0">
          <span
            class="px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full dark:bg-blue-900 dark:text-blue-300"
          >
            {{ cod_orders|length }} Pending Orders
          </span>
        </div>
      </div>
    </div>

    <!-- Orders Grid -->
    {% if cod_orders %}
    <form method="POST">
      {% csrf_token %}
      <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
        {% for order in cod_orders %}
        <div
          class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow duration-200"
        >
          <!-- Order Header -->
          <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <div class="flex justify-between items-start mb-4">
              <div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                  Order #{{ order.id }}
                </h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                  {{ order.product.product_name }}
                </p>
              </div>
              <div class="text-right">
                {% if order.payment_status != "Completed" %}
                <input
                  type="checkbox"
                  name="order_ids"
                  value="{{ order.id }}"
                  class="h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                />
                {% else %}
                <i
                  class="fas fa-check-circle text-green-500 text-xl"
                  title="Already Confirmed"
                ></i>
                {% endif %}
              </div>
            </div>

            <!-- Product Info -->
            <div class="flex items-center space-x-3">
              {% if order.product.image %}
              <img
                src="{{ order.product.image.url }}"
                alt="{{ order.product.product_name }}"
                class="w-12 h-12 rounded-lg object-cover"
              />
              {% else %}
              <div
                class="w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center"
              >
                <i class="fas fa-box text-gray-400"></i>
              </div>
              {% endif %}
              <div>
                <p class="text-sm font-medium text-gray-900 dark:text-white">
                  {{ order.product.product_name }}
                </p>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                  Qty: {{ order.quantity }} â€¢ {{ order.product.category }}
                </p>
              </div>
            </div>
          </div>

          <!-- Order Details -->
          <div class="p-6 space-y-4">
            <!-- Customer Info -->
            <div>
              <h4
                class="text-sm font-medium text-gray-900 dark:text-white mb-2"
              >
                Customer Information
              </h4>
              <div class="space-y-1">
                <div
                  class="flex items-center text-sm text-gray-600 dark:text-gray-400"
                >
                  <i class="fas fa-user mr-2 w-4"></i>
                  {{ order.user.username|title }}
                </div>
                <div
                  class="flex items-center text-sm text-gray-600 dark:text-gray-400"
                >
                  <i class="fas fa-envelope mr-2 w-4"></i>
                  {{ order.email }}
                </div>
                <div
                  class="flex items-center text-sm text-gray-600 dark:text-gray-400"
                >
                  <i class="fas fa-phone mr-2 w-4"></i>
                  {{ order.contact_no }}
                </div>
              </div>
            </div>

            <!-- Shipping Address -->
            <div>
              <h4
                class="text-sm font-medium text-gray-900 dark:text-white mb-2"
              >
                Shipping Address
              </h4>
              <div
                class="flex items-start text-sm text-gray-600 dark:text-gray-400"
              >
                <i
                  class="fas fa-map-marker-alt mr-2 mt-0.5 w-4 flex-shrink-0"
                ></i>
                <span>{{ order.address }}</span>
              </div>
            </div>

            <!-- Payment Details -->
            <div
              class="flex justify-between items-center pt-4 border-t border-gray-200 dark:border-gray-700"
            >
              <div>
                <p
                  class="text-2xl font-bold text-green-600 dark:text-green-400"
                >
                  NPR {{ order.total_price }}
                </p>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                  {{ order.payment_method }}
                </p>
              </div>
              <div>
                {% if order.payment_status == "Completed" %}
                <span
                  class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"
                >
                  <i class="fas fa-check-circle mr-1"></i>
                  Confirmed
                </span>
                {% else %}
                <span
                  class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"
                >
                  <i class="fas fa-clock mr-1"></i>
                  Pending
                </span>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      <!-- Action Buttons -->
      <div
        class="mt-8 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6"
      >
        <div
          class="flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0"
        >
          <a
            href="{% url 'admins' %}"
            class="inline-flex items-center px-6 py-3 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700 transition-colors duration-200 w-full sm:w-auto justify-center"
          >
            <i class="fas fa-arrow-left mr-2"></i>
            Back to Dashboard
          </a>
          <button
            type="submit"
            id="confirm-btn"
            class="inline-flex items-center px-8 py-3 text-sm font-medium text-white bg-green-600 border border-transparent rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 w-full sm:w-auto justify-center"
          >
            <i class="fas fa-check-circle mr-2"></i>
            Confirm Selected Payments
          </button>
        </div>
      </div>
    </form>
    {% else %}
    <!-- Empty State -->
    <div
      class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-12 text-center"
    >
      <div class="max-w-md mx-auto">
        <div
          class="w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4"
        >
          <i class="fas fa-credit-card text-gray-400 text-2xl"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">
          No Pending Payments
        </h3>
        <p class="text-gray-500 dark:text-gray-400 mb-6">
          There are no Cash on Delivery orders waiting for payment confirmation
          at the moment.
        </p>
        <a
          href="{% url 'admins' %}"
          class="inline-flex items-center px-6 py-3 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 transition-colors duration-200"
        >
          <i class="fas fa-arrow-left mr-2"></i>
          Back to Dashboard
        </a>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<script>
  // Update confirm button state based on checkbox selection
  function updateConfirmButton() {
    const checkboxes = document.querySelectorAll(
      'input[name="order_ids"]:checked'
    );
    const confirmBtn = document.getElementById("confirm-btn");
    confirmBtn.disabled = checkboxes.length === 0;

    // Update button text with count
    if (checkboxes.length > 0) {
      confirmBtn.innerHTML = `<i class="fas fa-check-circle mr-2"></i>Confirm ${
        checkboxes.length
      } Payment${checkboxes.length > 1 ? "s" : ""}`;
    } else {
      confirmBtn.innerHTML = `<i class="fas fa-check-circle mr-2"></i>Confirm Selected Payments`;
    }
  }

  // Add event listeners to all checkboxes
  document.addEventListener("DOMContentLoaded", function () {
    const checkboxes = document.querySelectorAll('input[name="order_ids"]');
    checkboxes.forEach((checkbox) => {
      checkbox.addEventListener("change", updateConfirmButton);
    });

    // Initialize button state
    updateConfirmButton();
  });

  // Select all functionality
  document.addEventListener("DOMContentLoaded", function () {
    // Create select all button in the header
    const header = document.querySelector(
      ".bg-white.dark\\:bg-gray-800.rounded-xl.shadow-sm"
    );
    if (header) {
      const selectAllDiv = document.createElement("div");
      selectAllDiv.className = "flex items-center space-x-2 mt-4";
      selectAllDiv.innerHTML = `
        <input type="checkbox" id="select-all" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
        <label for="select-all" class="text-sm font-medium text-gray-700 dark:text-gray-300">Select All Pending Orders</label>
      `;
      header.appendChild(selectAllDiv);

      // Select all functionality
      document
        .getElementById("select-all")
        .addEventListener("change", function (e) {
          const checkboxes = document.querySelectorAll(
            'input[name="order_ids"]'
          );
          checkboxes.forEach((checkbox) => {
            if (!checkbox.disabled) {
              checkbox.checked = e.target.checked;
            }
          });
          updateConfirmButton();
        });
    }
  });
</script>

<style>
  /* Custom styles for better card appearance */
  .order-card {
    transition: all 0.3s ease;
  }

  .order-card:hover {
    transform: translateY(-2px);
  }

  /* Ensure proper text wrapping for address */
  .address-text {
    word-wrap: break-word;
    white-space: normal;
  }
</style>
{% endblock admin_content %}
