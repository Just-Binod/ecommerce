{% extends "home.html" %} {% load crispy_forms_tags %} {% load static %}
<!---->
{% block main_section %}
<!-- Centered processing message -->
<h2 class="text-center text-2xl flex items-center justify-center gap-2 py-8">
  <i class="bi bi-arrow-clockwise animate-spin text-3xl text-green-600"></i>
  Processing please wait .......
</h2>

<!-- eSewa Payment Form -->
<form
  action="https://rc-epay.esewa.com.np/api/epay/main/v2/form"
  method="POST"
  id="esewaform"
>
  {% csrf_token %}
  <input type="hidden" name="amount" value="{{ data.amount }}" required />
  <input type="hidden" name="tax_amount" value="0" required />
  <input
    type="hidden"
    name="total_amount"
    value="{{ data.total_amount }}"
    required
  />
  <input
    type="hidden"
    name="transaction_uuid"
    value="{{ data.transaction_uuid }}"
    required
  />
  <input type="hidden" name="product_code" value="EPAYTEST" required />
  <input type="hidden" name="product_service_charge" value="0" required />
  <input type="hidden" name="product_delivery_charge" value="0" required />

  <!-- âœ… Correct success and failure URLs -->
  <input
    type="hidden"
    name="success_url"
    value="http://localhost:8000/esewaverify/{{ data.order_id }}/{{ data.cart_id }}/"
    required
  />
  <input
    type="hidden"
    name="failure_url"
    value="http://localhost:8000/esewaverify/{{ data.order_id }}/{{ data.cart_id }}/"
    required
  />

  <input
    type="hidden"
    name="signed_field_names"
    value="total_amount,transaction_uuid,product_code"
    required
  />
  <input type="hidden" name="signature" value="{{ data.signature }}" required />
</form>

<!-- Auto-submit after short delay -->
<script>
  setTimeout(function () {
    document.getElementById("esewaform").submit();
  }, 1500);
</script>
{% endblock main_section %}

<!---->
{% comment %} {% extends "home.html" %}

<!---->

{% load crispy_forms_tags %} {% load static %}
<!---->
{% block main_section %}
<!--    -->
<h2 class="">
  <i class="bi bi-arrow-clockwise animate-spin text-3xl"></i>
  Processing please wait .......
</h2>
<!---->

<form
  action="https://rc-epay.esewa.com.np/api/epay/main/v2/form"
  method="POST"
  id="esewaform"
>
  {% csrf_token %}
  <input
    type="hidden"
    id="amount"
    name="amount"
    value="{{data.amount}}"
    required
  />
  <input type="hidden" id="tax_amount" name="tax_amount" value="0" required />
  <input
    type="hidden"
    id="total_amount"
    name="total_amount"
    value="{{data.total_amount}}"
    required
  />
  <input
    type="hidden"
    id="transaction_uuid"
    name="transaction_uuid"
    value="{{data.transaction_uuid}}"
    required
  />
  <input
    type="hidden"
    id="product_code"
    name="product_code"
    value="EPAYTEST"
    required
  />
  <input
    type="hidden"
    id="product_service_charge"
    name="product_service_charge"
    value="0"
    required
  />
  <input
    type="hidden"
    id="product_delivery_charge"
    name="product_delivery_charge"
    value="0"
    required
  />
  <input
    type="hidden"
    id="success_url"
    name="success_url"
    value="http://localhost:8000/esewaverify{{order.id}}/{{cart.id}}"
    required
  />
  <input
    type="hidden"
    id="failure_url"
    name="failure_url"
    value="https://developer.esewa.com.np/failure"
    required
  />
  <input
    type="hidden"
    id="signed_field_names"
    name="signed_field_names"
    value="total_amount,transaction_uuid,product_code"
    required
  />
  <input
    type="hidden"
    id="signature"
    name="signature"
    value="{{data.signature}}"
    required
  />
  <input value="Submit" type="hidden" />
</form>

<script>
  setTimeout(function () {
    document.getElementById("esewaform").submit();
  }, 2000);
</script>

<!---->

{% endblock main_section %} {% endcomment %}
